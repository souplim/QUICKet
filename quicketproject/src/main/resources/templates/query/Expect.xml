<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.client.expect.dao.ExpectDao">
	
	<!-- 관리자 페이지 검색 기능 -->
	<sql id="boardSearch">
		<if test="search=='ex_title'">
			<![CDATA[ ex_title LIKE '%' || #{keyword} || '%' ]]>
		</if>
		<if test="search=='ex_content'">
			<![CDATA[ ex_content LIKE '%' || #{keyword} || '%' ]]>
		</if>
		<if test="search=='u_id'">
			<![CDATA[ u_id LIKE '%' || #{keyword} || '%' ]]>
		</if>
		<if test="search=='ex_regdate'">
			<![CDATA[ to_char(ex_regdate, 'YYYY-MM-DD') between #{start_date} and #{end_date} ]]>
		</if>
	</sql>
	
	<!-- 게시판 리스트 조회 -->
	<select id="expectList" parameterType="expect" resultType="expect">
	<![CDATA[
		SELECT 
			ex_no, ex_title, ex_content, u_id, to_char(ex_regdate, 'YYYY-MM-DD') as ex_regdate, ex_hit, s_num
		FROM (
			SELECT /*+ INDEX_DESC(expect pk_expect) */
				rownum as rno, ex_no, ex_title, ex_content, u_id, ex_regdate, ex_hit 
			FROM expect
			WHERE ]]>
			<trim prefix="(" suffix=") AND " prefixOverrides="AND">
				<include refid="boardSearch"></include>
			</trim>
		<![CDATA[	rownum <= #{pageNum} * #{amount}
		) expectlist
		WHERE rno > (#{pageNum} -1 ) * #{amount}
		]]>
	</select>
	
	<!-- 전체 레코드수 조회 -->
	<select id="expectListCnt" parameterType="expect" resultType="int">
		SELECT count(*) FROM expect
		<trim prefix=" where (" suffix=")">
			<include refid="boardSearch"></include>
		</trim> 
	</select>
	
	<!-- 게시물 등록 -->
	<insert id="expectInsert" parameterType="expect">
		INSERT INTO expect(ex_no, ex_title, ex_content, u_id, s_num)
		VALUES(expect_seq.nextval, #{ex_title}, #{ex_content}, #{u_id}, #{s_num})
	</insert>
	
	<!-- 상세페이지 조회 -->
	<select id="expectDetail" parameterType="expect" resultType="expect">
		/* Expect - expect Detail */
		SELECT
			ex_no, ex_title, ex_content, u_id, 
			TO_CHAR(ex_regdate, 'YYYY-MM-DD') AS ex_regdate
		FROM expect
		WHERE ex_no = #{ex_no}
	</select>
	
	<!-- 조회수 증가 처리 -->
	<update id="readCntUpdate" parameterType="expect">
	/* Expect - readCntUpdate */
	UPDATE expect
	SET ex_hit = ex_hit + 1
	WHERE ex_no = #{ex_no}
	</update>
	
	
	
	<!-- 게시글 수정 -->
	<update id="expectUpdate" parameterType="expect">
		/* Expect - expectUpdate */
		UPDATE expect
		SET ex_content = #{ex_content},
			ex_title = #{ex_title},
        	ex_regdate = SYSDATE
		WHERE ex_no = #{ex_no}
	</update>
	
	<!-- 게시글 삭제  -->
	<delete id="expectDelete" parameterType="expect">
		/* Expect - expectDelete */
		DELETE FROM expect WHERE ex_no = #{ex_no}
	</delete>
</mapper>