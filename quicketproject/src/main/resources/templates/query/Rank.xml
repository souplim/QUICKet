<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.common.task.RankDao">
	<select id="countTicketRate" parameterType="rankVO" resultType="rankVO">
		<![CDATA[
		select
		100*((select count(ti_num) 
		from ticket_seat ts  
		join hall h on ts.hall_id = h.hall_id 
		join ticket t on ts.ti_num = t.ti_num
		where h.th_num = #{th_num} 
		and t.ti_status = '예매중' 
		and to_char(seat_date, 'yyyy-MM-dd') between #{rank_start} and #{rank_end}
		)/(select count(seat_num) from seat s
		join hall h on s.hall_id = h.hall_id
		where h.th_num = #{th_num}))
		as rank_ticket
		from dual
		]]>
	</select>
	
	<insert id="insertRank" parameterType="rankVO">
	
	</insert>
</mapper>